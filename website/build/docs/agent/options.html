<!DOCTYPE html> <html lang=en> <head> <meta charset=utf-8> <meta name=viewport content="width=device-width, initial-scale=1.0"> <meta name=description content=""> <meta name=author content=""> <title>Configuration - Serf</title> <link href="/stylesheets/bootstrap.min-82fe1490.css" media=screen rel=stylesheet /><link href="/stylesheets/main-e5014f86.css" media=screen rel=stylesheet /> <!--[if lt IE 9]><script src="/javascripts/html5shiv-310dd184.js"></script> <script src="/javascripts/respond.min-88c91176.js"></script><![endif]--> <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-45101516-1', 'serfdom.io');
  ga('send', 'pageview');

</script> </head> <body class=page-Configuration> <div id=header> <div class=container> <a class="navbar-brand logo" href="/"> <span></span> </a> <a class="navbar-brand text rls-l" href="/">SERF</a> <ul class="buttons nav navbar-nav navbar-right rls-sb"> <li class=first><a href="/downloads.html">Download</a></li> <li><a href="https://github.com/hashicorp/serf">Github</a></li> </ul> <ul class="main-links nav navbar-nav navbar-right rls-sb"> <li><a href="/intro/index.html">Intro</a></li> <li><a href="/docs/index.html">Docs</a></li> <li><a href="/community.html">Community</a></li> </ul> </div> </div> <div class=container> <div class=col-md-4> <div class="docs-sidebar hidden-print affix-top" role=complementary> <ul class="nav docs-sidenav"> <li> <a href="/docs/index.html">Documentation Home</a> </li> <li> <a href="/docs/upgrading.html">Upgrading and Compatibility</a> <ul class=nav> <li> <a href="/docs/upgrading.html">Upgrading Serf</a> </li> <li> <a href="/docs/compatibility.html">Compatibility Promise</a> </li> </ul> </li> <li> <a href="/docs/internals/index.html">Serf Internals</a> <ul class=nav> <li> <a href="/docs/internals/gossip.html">Gossip Protocol</a> </li> <li> <a href="/docs/internals/security.html">Security Model</a> </li> <li> <a href="/docs/internals/simulator.html">Convergence Simulator</a> </li> </ul> </li> <li> <a href="/docs/commands/index.html">Serf Commands (CLI)</a> <ul class=nav> <li> <a href="/docs/commands/agent.html">agent</a> </li> <li> <a href="/docs/commands/event.html">event</a> </li> <li> <a href="/docs/commands/force-leave.html">force-leave</a> </li> <li> <a href="/docs/commands/join.html">join</a> </li> <li> <a href="/docs/commands/keygen.html">keygen</a> </li> <li> <a href="/docs/commands/leave.html">leave</a> </li> <li> <a href="/docs/commands/members.html">members</a> </li> <li> <a href="/docs/commands/monitor.html">monitor</a> </li> </ul> </li> <li class=active> <a href="/docs/agent/basics.html">Serf Agent</a> <ul class=nav> <li> <a href="/docs/agent/basics.html">Running and Stopping</a> </li> <li class=active> <a href="/docs/agent/options.html">Configuration</a> </li> <li> <a href="/docs/agent/event-handlers.html">Event Handlers</a> </li> <li> <a href="/docs/agent/encryption.html">Encryption</a> </li> <li> <a href="/docs/agent/rpc.html">RPC Protocol</a> </li> </ul> <li> <a href="/docs/roadmap.html">Roadmap</a> </li> </ul> </div> </div> <div class=col-md-8 role=main> <div class=bs-docs-section> <h1 id=toc_0>Configuration</h1> <p>The agent has various configuration options that can be specified via the command-line or via configuration files. All of the configuration options are completely optional and their defaults will be specified with their descriptions.</p> <p>When loading configuration, Serf loads the configuration from files and directories in the order specified. Configuration specified later will be merged into configuration specified earlier. In most cases, &quot;merge&quot; means that the later version will override the earlier. But in some cases, such as event handlers, merging just appends the handlers. The exact merging behavior will be specified.</p> <p>Serf also supports reloading of configuration when it receives the SIGHUP signal. Not all changes are respected, but those that are are documented below.</p> <h2 id=toc_1>Command-line Options</h2> <p>The options below are all specified on the command-line.</p> <ul> <li><p><code>-bind</code> - The address that Serf will bind to for communication with other Serf nodes. By default this is &quot;0.0.0.0:7946&quot;. Serf nodes may have different ports. If a join is specified without a port, we default to locally configured port. Serf uses both TCP and UDP and use the same port for both, so if you have any firewalls be sure to allow both protocols. If this configuration value is changed and no port is specified, the default of &quot;7946&quot; will be used. An important compatibility note, protocol version 2 introduces support for non-consistent ports across the cluster. For more information, see the <a href="/docs/compatibility.html">compatibility page</a>.</p></li> <li><p><code>-config-file</code> - A configuration file to load. For more information on the format of this file, read the &quot;Configuration Files&quot; section below. This option can be specified multiple times to load multiple configuration files. If it is specified multiple times, configuration files loaded later will merge with configuration files loaded earlier, with the later values overriding the earlier values.</p></li> <li><p><code>-config-dir</code> - A directory of configuration files to load. Serf will load all files in this directory ending in &quot;.json&quot; as configuration files in alphabetical order. For more information on the format of the configuration files, see the &quot;Configuration Files&quot; section below.</p></li> <li><p><code>-encrypt</code> - Specifies the secret key to use for encryption of Serf network traffic. This key must be 16-bytes that are base64 encoded. The easiest way to create an encryption key is to use <code>serf keygen</code>. All nodes within a cluster must share the same encryption key to communicate.</p></li> <li><p><code>-event-handler</code> - Adds an event handler that Serf will invoke for events. This flag can be specified multiple times to define multiple event handlers. By default no event handlers are registered. See the <a href="/docs/agent/event-handlers.html">event handler page</a> for more details on event handlers as well as a syntax for filtering event handlers by event. Event handlers can be changed by reloading the configuration.</p></li> <li><p><code>-join</code> - Address of another agent to join upon starting up. This can be specified multiple times to specify multiple agents to join. If Serf is unable to join with any of the specified addresses, agent startup will fail. By default, the agent won&#39;t join any nodes when it starts up.</p></li> <li><p><code>-replay</code> - If set, old user events from the past will be replayed for the agent/cluster that is joining based on a <code>-join</code> configuration. Otherwise, past events will be ignored. This configures for the initial join only.</p></li> <li><p><code>-log-level</code> - The level of logging to show after the Serf agent has started. This defaults to &quot;info&quot;. The available log levels are &quot;trace&quot;, &quot;debug&quot;, &quot;info&quot;, &quot;warn&quot;, &quot;err&quot;. This is the log level that will be shown for the agent output, but note you can always connect via <code>serf monitor</code> to an agent at any log level. The log level can be changed during a config reload.</p></li> <li><p><code>-node</code> - The name of this node in the cluster. This must be unique within the cluster. By default this is the hostname of the machine.</p></li> <li><p><code>-profile</code> - Serf by default is configured to run in a LAN or Local Area Network. However, there are cases in which a user may want to use Serf over the Internet or (WAN), or even just locally. To support setting the correct configuration values for each environment, you can select a timing profile. The current choices are &quot;lan&quot;, &quot;wan&quot;, and &quot;local&quot;. This defaults to &quot;local&quot;. If a &quot;lan&quot; or &quot;local&quot; profile is used over the Internet, or a &quot;local&quot; profile over the LAN, a high rate of false failures is risked, as the timing constaints are too tight.</p></li> <li><p><code>-protocol</code> - The Serf protocol version to use. This defaults to the latest version. This should be set only when <a href="/docs/upgrading.html">upgrading</a>. You can view the protocol versions supported by Serf by running <code>serf -v</code>.</p></li> <li><p><code>-role</code> - The role of this node, if any. By default this is blank or empty. The role can be used by events in order to differentiate members of a cluster that may have different functional roles. For example, if you&#39;re using Serf in a load balancer and web server setup, you only want to add web servers to the load balancers, so the role of web servers may be &quot;web&quot; and the event handlers can filter on that.</p></li> <li><p><code>-rpc-addr</code> - The address that Serf will bind to for the agent&#39;s RPC server. By default this is &quot;127.0.0.1:7373&quot;, allowing only loopback connections. The RPC address is used by other Serf commands, such as <code>serf members</code>, in order to query a running Serf agent. It is also used by other applications to control Serf using it&#39;s <a href="/docs/agent/rpc.html">RPC protocol</a>.</p></li> <li><p><code>-snapshot</code> - The snapshot flag provides a file path that is used to store recovery information, so when Serf restarts it is able to automatically re-join the cluster, and avoid replay of events it has already seen. The path must be read/writable by Serf, and the directory must allow Serf to create other files, so that it can periodically compact the snapshot file.</p></li> </ul> <h2 id=toc_2>Configuration Files</h2> <p>In addition to the command-line options, configuration can be put into files. This may be easier in certain situations, for example when Serf is being configured using a configuration management system.</p> <p>The configuration files are JSON formatted, making them easily readable and editable by both humans and computers. The configuration is formatted at a single JSON object with configuration within it.</p> <h4 id=toc_3>Example Configuration File</h4> <pre class="prettyprint lang-json">
{
  "role": "load-balancer",

  "event_handlers": [
    "handle.sh",
    "user:deploy=deploy.sh"
  ]
}
</pre> <h4 id=toc_4>Configuration Key Reference</h4> <ul> <li><p><code>node_name</code> - Equivalent to the <code>-node</code> command-line flag.</p></li> <li><p><code>role</code> - Equivalent to the <code>-role</code> command-line flag.</p></li> <li><p><code>bind</code> - Equivalent to the <code>-bind</code> command-line flag.</p></li> <li><p><code>encrypt_key</code> - Equivalent to the <code>-encrypt</code> command-line flag.</p></li> <li><p><code>log_level</code> - Equivalent to the <code>-log-level</code> command-line flag.</p></li> <li><p><code>profile</code> - Equivalent to the <code>-profile</code> command-line flag.</p></li> <li><p><code>protocol</code> - Equivalent to the <code>-protocol</code> command-line flag.</p></li> <li><p><code>rpc_addr</code> - Equivalent to the <code>-rpc-addr</code> command-line flag.</p></li> <li><p><code>event_handlers</code> - An array of strings specifying the event handlers. The format of the strings is equivalent to the format specified for the <code>-event-handler</code> command-line flag.</p></li> <li><p><code>start_join</code> - An array of strings specifying addresses of nodes to join upon startup.</p></li> <li><p><code>replay_on_join</code> - Equivalent to the <code>-replay</code> command-line flag.</p></li> <li><p><code>snapshot_path</code> - Equivalent to the <code>-snapshot</code> command-line flag.</p></li> <li><p><code>leave_on_terminate</code> - If enabled, when the agent receives a TERM signal, it will send a Leave message to the rest of the cluster and gracefully leave. Defaults to false.</p></li> <li><p><code>leave_on_interrupt</code> - This is the same as <code>leave_on_terminate</code> but only affects interrupt handling. This is usually from a Control-C from a shell. Defaults to true.</p></li> </ul> </div> </div> </div> <div id=footer> <div class=container> <div class=footer-links> <ul class="main-links nav navbar-nav rls-sb"> <li><a href="/intro/index.html">Intro</a></li> <li class=active><a href="/docs/index.html">Docs</a></li> <li><a href="/community.html">Community</a></li> </ul> <ul class="buttons nav navbar-nav rls-sb"> <li class=first><a href="/downloads.html">Download</a></li> <li><a href="https://github.com/hashicorp/serf">Github</a></li> </ul> </div> <div class=footer-logo> <span></span> </div> <div class="footer-hashi os"> <span>© 2013. A <a href="//www.hashicorp.com">HashiCorp</a> Project.</span> <a href="//www.hashicorp.com"><img src="/images/hashi-logo-s-3644fe63.png"></a> </div> </div> </div> <script src="javascripts/lib/d3.v3.min.js"></script> <script src="javascripts/app/deploy/site.js"></script> <script>
	Serf.initialize();
</script> </body> </html>